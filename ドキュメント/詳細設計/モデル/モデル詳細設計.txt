# 🟩 モデル詳細設計：各モデルの役割と使用場面（初心者向け・段階的）

---

# 📋 目次

1. [共通・認証まわり](#共通認証まわり)
2. [企業側モデル](#企業側モデル)
3. [フリーランス側モデル](#フリーランス側モデル)
4. [応募・コミュニケーション系](#応募コミュニケーション系)

---

# 共通・認証まわり

## 1. User（ユーザー）

### 🌱 役割

ログイン情報の本体です。企業とフリーランスのどちらでログインしているかを判定するための軸として機能します。

### 📊 データベース構造

+------------------+------------------------------------------+
| カラム名         | 型・制約                                  |
+------------------+------------------------------------------+
| id               | bigint（主キー）                          |
| email            | string（ユニーク、必須）                  |
| password         | string（必須、ハッシュ化）                |
| role             | enum('company', 'freelancer')（必須）     |
| email_verified_at | timestamp（nullable）                    |
| remember_token   | string（nullable）                        |
| created_at       | timestamp                                 |
| updated_at       | timestamp                                 |
+------------------+------------------------------------------+

### 🔗 リレーション

- **User → Company（1対1の関係）**
  - 1人のユーザーは1つの企業プロフィールを持つことができます
  - 企業として登録した場合にのみ、この関係が成立します

- **User → Freelancer（1対1の関係）**
  - 1人のユーザーは1つのフリーランスプロフィールを持つことができます
  - フリーランスとして登録した場合にのみ、この関係が成立します

### 🎯 主な使用場面

1. **ログイン認証時**
   - メールアドレスとパスワードで認証を行います
   - ログイン成功後、role（役割）に応じて画面遷移を分岐させます
   - フリーランスの場合は案件一覧画面へ、企業の場合はフリーランス一覧画面へ遷移します

2. **画面遷移の判定**
   - ログイン後の最初の画面を決定するために使用します
   - フリーランス：案件一覧画面へ遷移
   - 企業：フリーランス一覧画面へ遷移

3. **権限チェック**
   - アクセスしようとしている画面に権限があるかを確認します
   - 企業専用の画面にフリーランスがアクセスしようとした場合、アクセスを制御します
   - 逆に、フリーランス専用の画面に企業がアクセスしようとした場合も同様です

### 💡 実装メモ

- **認証機能**：Laravelの標準認証機能を使用してログイン処理を行います
- **roleによる分岐**：ミドルウェアやコントローラーでroleをチェックして、適切な画面へ誘導します
- **パスワード管理**：セキュリティのため、パスワードはハッシュ化して保存します

---

# 企業側モデル

## 2. Company（企業）

### 🌱 役割

企業プロフィールの本体です。案件の作成、フリーランスへのスカウト送信、チャット機能の起点として機能します。

### 📊 データベース構造

+------------------+------------------------------------------+
| カラム名         | 型・制約                                  |
+------------------+------------------------------------------+
| id               | bigint（主キー）                          |
| user_id          | bigint（外部キー、users.id 参照）         |
| name             | string（必須）                            |
| overview         | text（nullable）                          |
| contact_name     | string（nullable）                        |
| department       | string（nullable）                        |
| introduction     | text（nullable）                          |
| created_at       | timestamp                                 |
| updated_at       | timestamp                                 |
+------------------+------------------------------------------+

### 🔗 リレーション

- **Company → User（1対1の関係）**
  - 企業プロフィールは必ず1人のユーザーに紐づいています
  - ユーザーが削除されると、企業プロフィールも削除されます

- **Company → Job（1対多の関係）**
  - 1つの企業は複数の案件を持つことができます
  - 企業が作成したすべての案件を取得できます

- **Company → Scout（1対多の関係）**
  - 1つの企業は複数のスカウトを送信できます
  - 企業が送信したすべてのスカウト履歴を取得できます

- **Company → Thread（1対多の関係）**
  - 1つの企業は複数のチャットスレッドに参加できます
  - 企業が関わっているすべてのチャットスレッドを取得できます

### 🎯 主な使用場面

1. **企業プロフィール登録時**
   - アカウント作成後に企業情報を登録します
   - 企業名、会社概要、担当者名、部署、自己紹介などを登録します
   - 案件詳細画面に企業名や会社概要を表示するために使用します

2. **案件管理時**
   - 自社が作成した案件の一覧を取得します
   - 案件を作成する際に、どの企業が作成したかを紐付けます
   - 公開中の案件、下書きの案件、停止中の案件などを管理します

3. **スカウト送信時**
   - フリーランスにスカウトを送信する際に使用します
   - スカウト履歴を管理し、どのフリーランスにスカウトを送ったかを記録します

4. **チャット参加時**
   - 企業とフリーランスのチャットスレッドに参加します
   - 自分が関わっているチャットスレッドの一覧を取得します

### 💡 実装メモ

- **プロフィール表示**：案件詳細画面で企業情報を表示する際に使用します
- **検索対象**：フリーランス検索では使用しません（企業側が検索する側です）
- **削除時の挙動**：ユーザーが削除されると、企業情報も自動的に削除されます

---

## 3. Job（案件）

### 🌱 役割

企業が掲載する案件情報です。フリーランスが閲覧・応募する対象として機能します。

### 📊 データベース構造

+------------------+------------------------------------------+
| カラム名         | 型・制約                                  |
+------------------+------------------------------------------+
| id               | bigint（主キー）                          |
| company_id       | bigint（外部キー、companies.id 参照）     |
| title            | string（必須）                            |
| description      | text（必須）                              |
| required_skills_text | text（nullable）                    |
| reward_type      | enum('monthly', 'hourly')（必須）        |
| min_rate         | unsignedInteger（必須）                  |
| max_rate         | unsignedInteger（必須）                  |
| work_time_text   | string（必須）                            |
| status           | unsignedTinyInteger（0=下書き, 1=公開, 2=停止） |
| created_at       | timestamp                                 |
| updated_at       | timestamp                                 |
+------------------+------------------------------------------+

### 🔗 リレーション

- **Job → Company（多対1の関係）**
  - 案件は必ず1つの企業に紐づいています
  - どの企業が作成した案件かを特定できます

- **Job → Application（1対多の関係）**
  - 1つの案件には複数の応募が来ることがあります
  - 案件に応募したすべてのフリーランスを取得できます

- **Job → Scout（1対多の関係）**
  - 1つの案件に関連する複数のスカウトが存在する場合があります
  - 案件に紐づくスカウト履歴を取得できます

- **Job → Thread（1対多の関係）**
  - 1つの案件に関連する複数のチャットスレッドが存在する場合があります
  - 案件に関連するすべてのチャットスレッドを取得できます

### 🎯 主な使用場面

1. **案件一覧表示時**
   - フリーランス側：公開中の案件のみを表示します（status = 1の案件）
   - 企業側：自社が作成した案件を全て表示します（ステータスに関係なく）

2. **案件詳細表示時**
   - 案件の全文情報を表示します
   - タイトル、説明、必要なスキル、報酬、勤務時間などを表示します
   - 応募ボタンの表示判定を行います（既に応募済みかどうかを確認）

3. **案件登録・編集時**
   - 企業が案件情報を登録・更新します
   - 報酬タイプ（月額報酬か時給報酬か）に応じて表示を分岐させます
   - 月額報酬の場合は「30万円〜50万円」、時給報酬の場合は「2000円〜3000円」のように表示します

4. **応募管理時**
   - 案件への応募一覧を取得します
   - 応募ステータス（未対応、対応中、クローズ）を管理します

### 💡 実装メモ

- **ステータス管理**：0=下書き、1=公開、2=停止の3つの状態で管理します
- **報酬表示**：報酬タイプに応じて「30万円〜50万円」または「2000円〜3000円」と表示します
- **検索対象**：キーワード検索でタイトル、説明、必要なスキルを検索します

---

## 4. Scout（スカウト）

### 🌱 役割

企業からフリーランスへのスカウト履歴です。スカウトを起点としてチャットスレッドを生成するトリガーとして機能します。

### 📊 データベース構造

+------------------+------------------------------------------+
| カラム名         | 型・制約                                  |
+------------------+------------------------------------------+
| id               | bigint（主キー）                          |
| company_id       | bigint（外部キー、companies.id 参照）     |
| freelancer_id    | bigint（外部キー、freelancers.id 参照）   |
| job_id           | bigint（外部キー、jobs.id 参照、nullable）|
| message          | text（必須）                              |
| status           | unsignedTinyInteger（0=未対応, 1=対応中, 2=クローズ） |
| created_at       | timestamp                                 |
| updated_at       | timestamp                                 |
+------------------+------------------------------------------+

### 🔗 リレーション

- **Scout → Company（多対1の関係）**
  - スカウトは必ず1つの企業に紐づいています
  - どの企業がスカウトを送ったかを特定できます

- **Scout → Freelancer（多対1の関係）**
  - スカウトは必ず1人のフリーランスに紐づいています
  - どのフリーランスにスカウトを送ったかを特定できます

- **Scout → Job（多対1の関係、nullable）**
  - スカウトは特定の案件に紐づくことも、紐づかないこともあります
  - 案件に紐づかない一般的なスカウトも送信可能です

- **Scout → Thread（1対1の関係）**
  - スカウトを送信すると、自動的にチャットスレッドが1つ生成されます
  - スカウトを起点にしたチャットが開始されます

### 🎯 主な使用場面

1. **スカウト送信時**
   - 企業がフリーランスにスカウトを送信します
   - スカウトレコードを作成すると同時に、チャットスレッドも自動的に生成されます
   - スカウトメッセージが最初のメッセージとしてチャットに表示されます

2. **スカウト一覧表示時**
   - フリーランス側：届いたスカウトを一覧表示します
   - 企業側：送信したスカウトを一覧表示します
   - スカウトの送信日時、送信先、ステータスなどを確認できます

3. **スカウトチャット表示時**
   - スカウトを起点にしたチャット画面を表示します
   - 最初のメッセージとしてスカウト文を表示します
   - そこから企業とフリーランスが会話を続けます

4. **ステータス管理時**
   - スカウトの進捗を管理します
   - 未対応→対応中→クローズの順にステータスを更新します

### 💡 実装メモ

- **案件紐付け**：job_idはnullableなので、案件に紐づかないスカウトも送信可能です
- **スレッド生成**：スカウト送信時に自動的にチャットスレッドを生成します
- **重複チェック**：同じ企業から同じフリーランスへの重複スカウトは任意で制御できます

---

# フリーランス側モデル

## 5. Freelancer（フリーランス）

### 🌱 役割

フリーランスのプロフィール本体です。検索・表示の中心となるモデルです。

### 📊 データベース構造

+------------------+------------------------------------------+
| カラム名         | 型・制約                                  |
+------------------+------------------------------------------+
| id               | bigint（主キー）                          |
| user_id          | bigint（外部キー、users.id 参照）         |
| display_name     | string（必須）                            |
| job_title        | string（必須）                            |
| bio              | text（必須）                              |
| min_hours_per_week | unsignedTinyInteger（必須）         |
| max_hours_per_week | unsignedTinyInteger（必須）         |
| hours_per_day    | unsignedTinyInteger（必須）               |
| days_per_week    | unsignedTinyInteger（必須）               |
| work_style_text  | text（必須）                              |
| min_rate         | unsignedInteger（必須）                   |
| max_rate         | unsignedInteger（必須）                   |
| experience_companies | text（nullable）                   |
| icon_path        | string（必須）                            |
| created_at       | timestamp                                 |
| updated_at       | timestamp                                 |
+------------------+------------------------------------------+

### 🔗 リレーション

- **Freelancer → User（1対1の関係）**
  - フリーランスプロフィールは必ず1人のユーザーに紐づいています
  - ユーザーが削除されると、フリーランスプロフィールも削除されます

- **Freelancer → Application（1対多の関係）**
  - 1人のフリーランスは複数の案件に応募できます
  - フリーランスが応募したすべての案件を取得できます

- **Freelancer → Scout（1対多の関係）**
  - 1人のフリーランスは複数のスカウトを受け取ることができます
  - フリーランスが受け取ったすべてのスカウトを取得できます

- **Freelancer → Thread（1対多の関係）**
  - 1人のフリーランスは複数のチャットスレッドに参加できます
  - フリーランスが関わっているすべてのチャットスレッドを取得できます

- **Freelancer → Skill（多対多の関係）**
  - 1人のフリーランスは複数のスキルを持つことができます
  - 共通スキル辞書から選択したスキルを関連付けます
  - 中間テーブル（freelancer_skill）を通じて関連付けられます

- **Freelancer → FreelancerCustomSkill（1対多の関係）**
  - 1人のフリーランスは複数のカスタムスキルを持つことができます
  - 共通スキル辞書にない独自のスキルを自由入力で登録できます

- **Freelancer → FreelancerPortfolio（1対多の関係）**
  - 1人のフリーランスは複数のポートフォリオURLを持つことができます
  - 過去の作品や実績を紹介するためのURLを複数登録できます

### 🎯 主な使用場面

1. **プロフィール登録・編集時**
   - フリーランスの基本情報を登録・更新します
   - 表示名、職種、自己紹介、稼働条件、希望単価、経験企業、アイコン画像などを登録します
   - 稼働条件は4つのカラムで管理します（週の最小時間、週の最大時間、1日の時間、週の日数）

2. **フリーランス検索時**
   - 企業が条件に合うフリーランスを検索します
   - キーワード検索で表示名、職種、自己紹介、働き方のテキストを検索します
   - スキル、希望単価、稼働条件などで絞り込み検索も可能です

3. **フリーランス一覧表示時**
   - 企業側でフリーランスを一覧表示します
   - スキル、経験企業、希望単価、ポートフォリオなどを表示します
   - プロフィール画像や基本情報を表示します

4. **応募・スカウト管理時**
   - 応募した案件の一覧を取得します
   - 届いたスカウトの一覧を取得します
   - 応募やスカウトのステータスを管理します

### 💡 実装メモ

- **稼働条件**：4つのカラムで正規化して管理します（週の最小時間、週の最大時間、1日の時間、週の日数）
- **希望単価**：月額報酬と時給報酬のどちらも保存可能です（最小単価と最大単価）
- **検索対象**：プロフィール全体を横断検索します（全文検索のようなイメージ）

---

## 6. FreelancerPortfolio（ポートフォリオ）

### 🌱 役割

フリーランスのポートフォリオURLを管理します。複数のURLを登録可能です。

### 📊 データベース構造

+------------------+------------------------------------------+
| カラム名         | 型・制約                                  |
+------------------+------------------------------------------+
| id               | bigint（主キー）                          |
| freelancer_id    | bigint（外部キー、freelancers.id 参照）   |
| url              | string（必須）                            |
| sort_order       | unsignedSmallInteger（デフォルト0）       |
| created_at       | timestamp                                 |
| updated_at       | timestamp                                 |
+------------------+------------------------------------------+

### 🔗 リレーション

- **FreelancerPortfolio → Freelancer（多対1の関係）**
  - ポートフォリオは必ず1人のフリーランスに紐づいています
  - フリーランスが削除されると、ポートフォリオも削除されます

### 🎯 主な使用場面

1. **プロフィール登録・編集時**
   - ポートフォリオURLを複数登録します
   - 過去の作品や実績を紹介するためのURLを登録します
   - 表示順をsort_orderで制御します（数字が小さい順に表示されます）

2. **フリーランス一覧表示時**
   - 企業側でポートフォリオURLを表示します
   - リンクとして表示し、クリックするとポートフォリオサイトに遷移します
   - 複数のポートフォリオがある場合は、順番に表示します

### 💡 実装メモ

- **複数登録**：1人のフリーランスに対して複数のポートフォリオURLを登録可能です
- **表示順**：sort_orderで並び順を制御します（数字が小さい順に表示されます）
- **URL形式チェック**：バリデーションでURL形式をチェックします

---

## 7. Skill（スキル）

### 🌱 役割

サービス全体で共通のスキル辞書です。正規化されたスキル一覧として機能します。

### 📊 データベース構造

+------------------+------------------------------------------+
| カラム名         | 型・制約                                  |
+------------------+------------------------------------------+
| id               | bigint（主キー）                          |
| name             | string（ユニーク、必須）                 |
| created_at       | timestamp                                 |
| updated_at       | timestamp                                 |
+------------------+------------------------------------------+

### 🔗 リレーション

- **Skill → Freelancer（多対多の関係）**
  - 1つのスキルは複数のフリーランスに紐づくことができます
  - 1人のフリーランスは複数のスキルを持つことができます
  - 中間テーブル（freelancer_skill）を通じて関連付けられます

### 🎯 主な使用場面

1. **プロフィール登録・編集時**
   - フリーランスがスキルを選択します
   - 複数選択可能です（タグ形式で選択）
   - 例：「PHP」「JavaScript」「Laravel」など

2. **フリーランス検索時**
   - 企業がスキルでフリーランスを検索します
   - 特定のスキルを持つフリーランスを絞り込みます
   - 例：「PHP」というスキルを持つフリーランスを検索

3. **フリーランス表示時**
   - フリーランスのスキルをタグ形式で表示します
   - プロフィール画面や一覧画面でスキルを表示します

### 💡 実装メモ

- **一元管理**：スキル名を一元管理し、重複を防止します
- **中間テーブル**：freelancer_skillという中間テーブルでフリーランスとスキルを関連付けます
- **検索対象**：スキル名でフリーランスを検索可能です

---

## 8. FreelancerSkill（フリーランススキル中間テーブル）

### 🌱 役割

フリーランスと共通スキルの中間モデルです。タグ選択の実体として機能します。

### 📊 データベース構造

+------------------+------------------------------------------+
| カラム名         | 型・制約                                  |
+------------------+------------------------------------------+
| id               | bigint（主キー）                          |
| freelancer_id    | bigint（外部キー、freelancers.id 参照）   |
| skill_id         | bigint（外部キー、skills.id 参照）        |
| created_at       | timestamp                                 |
| updated_at       | timestamp                                 |
+------------------+------------------------------------------+

### 🔗 リレーション

- **FreelancerSkill → Freelancer（多対1の関係）**
  - 中間レコードは必ず1人のフリーランスに紐づいています

- **FreelancerSkill → Skill（多対1の関係）**
  - 中間レコードは必ず1つのスキルに紐づいています

### 🎯 主な使用場面

1. **プロフィール登録・編集時**
   - フリーランスがスキルを選択します
   - 重複登録を防止します（同じスキルを2回選択できないようにします）
   - スキルの追加や削除を行います

2. **フリーランス検索時**
   - スキルでフリーランスを絞り込みます
   - 特定のスキルを持つフリーランスを検索します

### 💡 実装メモ

- **重複防止**：freelancer_idとskill_idの組み合わせでユニーク制約を設定します
- **中間テーブル**：LaravelのbelongsToManyリレーションで管理します

---

## 9. FreelancerCustomSkill（カスタムスキル）

### 🌱 役割

フリーランスが自由入力したスキルです。プロフィール表示用の強み表現として機能します。

### 📊 データベース構造

+------------------+------------------------------------------+
| カラム名         | 型・制約                                  |
+------------------+------------------------------------------+
| id               | bigint（主キー）                          |
| freelancer_id    | bigint（外部キー、freelancers.id 参照）   |
| name             | string（必須、インデックスあり）          |
| sort_order       | unsignedSmallInteger（デフォルト0）       |
| created_at       | timestamp                                 |
| updated_at       | timestamp                                 |
+------------------+------------------------------------------+

### 🔗 リレーション

- **FreelancerCustomSkill → Freelancer（多対1の関係）**
  - カスタムスキルは必ず1人のフリーランスに紐づいています
  - フリーランスが削除されると、カスタムスキルも削除されます

### 🎯 主な使用場面

1. **プロフィール登録・編集時**
   - フリーランスが自由入力でスキルを追加します
   - 共通スキル辞書にない独自のスキル表現を可能にします
   - 複数のカスタムスキルを登録可能です
   - 例：「React Native」「Vue.js 3.0」など、辞書にない新しい技術名

2. **フリーランス検索時**
   - キーワード検索でnameカラムを検索対象に含めます
   - カスタムスキル名でもフリーランスを検索できます
   - インデックスで検索性能を向上させます

3. **フリーランス表示時**
   - プロフィールにカスタムスキルを表示します
   - 共通スキルと同様にタグ形式で表示します
   - 表示順をsort_orderで制御します

### 💡 実装メモ

- **検索対象**：nameカラムにインデックスを設定し、検索性能を向上させます
- **表示順**：sort_orderで並び順を制御します（数字が小さい順に表示されます）
- **自由入力**：共通スキルにない独自のスキル表現を可能にします

---

# 応募・コミュニケーション系

## 10. Application（応募）

### 🌱 役割

フリーランスの案件応募記録です。応募を起点としてチャットスレッドを生成するトリガーとして機能します。

### 📊 データベース構造

+------------------+------------------------------------------+
| カラム名         | 型・制約                                  |
+------------------+------------------------------------------+
| id               | bigint（主キー）                          |
| job_id           | bigint（外部キー、jobs.id 参照）         |
| freelancer_id    | bigint（外部キー、freelancers.id 参照）   |
| message          | text（必須）                              |
| status           | unsignedTinyInteger（0=未対応, 1=対応中, 2=クローズ） |
| created_at       | timestamp                                 |
| updated_at       | timestamp                                 |
+------------------+------------------------------------------+

### 🔗 リレーション

- **Application → Job（多対1の関係）**
  - 応募は必ず1つの案件に紐づいています
  - どの案件に応募したかを特定できます

- **Application → Freelancer（多対1の関係）**
  - 応募は必ず1人のフリーランスに紐づいています
  - どのフリーランスが応募したかを特定できます

- **Application → Thread（1対1の関係）**
  - 応募を送信すると、自動的にチャットスレッドが1つ生成されます
  - 応募を起点にしたチャットが開始されます

### 🎯 主な使用場面

1. **応募送信時**
   - フリーランスが案件に応募します
   - 応募レコードを作成すると同時に、チャットスレッドも自動的に生成されます
   - 応募メッセージが最初のメッセージとしてチャットに表示されます

2. **応募一覧表示時**
   - フリーランス側：応募した案件を一覧表示します
   - 企業側：応募された案件を一覧表示します
   - 応募の送信日時、応募先、ステータスなどを確認できます

3. **応募チャット表示時**
   - 応募を起点にしたチャット画面を表示します
   - 最初のメッセージとして応募文を表示します
   - そこから企業とフリーランスが会話を続けます

4. **ステータス管理時**
   - 応募の進捗を管理します
   - 未対応→対応中→クローズの順にステータスを更新します

### 💡 実装メモ

- **重複防止**：job_idとfreelancer_idの組み合わせでユニーク制約を設定します（同じ案件に2回応募できないようにします）
- **スレッド生成**：応募送信時に自動的にチャットスレッドを生成します
- **最初のメッセージ**：応募文がチャット画面の最初のメッセージとして表示されます

---

## 11. Thread（スレッド）

### 🌱 役割

チャットの部屋（会話単位）です。企業とフリーランスと案件の組み合わせを一意に管理し、未読フラグを管理します。

### 📊 データベース構造

+------------------+------------------------------------------+
| カラム名         | 型・制約                                  |
+------------------+------------------------------------------+
| id               | bigint（主キー）                          |
| company_id       | bigint（外部キー、companies.id 参照）     |
| freelancer_id    | bigint（外部キー、freelancers.id 参照）   |
| job_id           | bigint（外部キー、jobs.id 参照、nullable）|
| latest_sender_type | enum('company', 'freelancer')（nullable）|
| latest_sender_id | bigint（nullable）                        |
| latest_message_at | timestamp（nullable）                   |
| is_unread_for_company | boolean（デフォルトfalse）        |
| is_unread_for_freelancer | boolean（デフォルトfalse）      |
| created_at       | timestamp                                 |
| updated_at       | timestamp                                 |
+------------------+------------------------------------------+

### 🔗 リレーション

- **Thread → Company（多対1の関係）**
  - スレッドは必ず1つの企業に紐づいています
  - どの企業が参加しているスレッドかを特定できます

- **Thread → Freelancer（多対1の関係）**
  - スレッドは必ず1人のフリーランスに紐づいています
  - どのフリーランスが参加しているスレッドかを特定できます

- **Thread → Job（多対1の関係、nullable）**
  - スレッドは特定の案件に紐づくことも、紐づかないこともあります
  - 応募やスカウトを起点にしたスレッドの場合は案件に紐づきます
  - 一般的なチャットの場合は案件に紐づかないこともあります

- **Thread → Message（1対多の関係）**
  - 1つのスレッドには複数のメッセージが含まれます
  - スレッド内のすべてのメッセージを取得できます

### 🎯 主な使用場面

1. **応募・スカウト送信時**
   - 応募やスカウトを送信すると、自動的にスレッドが生成されます
   - 既存のスレッドがある場合は再利用します（同じ企業とフリーランスと案件の組み合わせの場合）

2. **チャット画面表示時**
   - スレッドに紐づくメッセージを一覧表示します
   - 未読フラグを確認して未読バッジを表示します
   - 最後に送信されたメッセージの情報を表示します

3. **メッセージ送信時**
   - メッセージを送信すると、スレッドの未読フラグを更新します
   - 最後の送信者情報を更新します
   - 最後のメッセージ送信日時を更新します

4. **未読解除時**
   - チャット画面を開いた時点で未読フラグを解除します
   - 自分が最後に送信したメッセージの場合は未読になりません

### 💡 実装メモ

- **一意性**：企業とフリーランスと案件の組み合わせで1つのスレッドのみ存在します
- **未読判定**：最後の送信者が自分以外の場合に未読とします
- **スレッド単位**：メッセージ単位ではなくスレッド単位で未読を管理します

---

## 12. Message（メッセージ）

### 🌱 役割

チャット内の1つのメッセージです。本文と送信者を保持し、自分のメッセージを削除（論理削除）できます。

### 📊 データベース構造

+------------------+------------------------------------------+
| カラム名         | 型・制約                                  |
+------------------+------------------------------------------+
| id               | bigint（主キー）                          |
| thread_id        | bigint（外部キー、threads.id 参照）       |
| sender_type      | enum('company', 'freelancer')（必須）     |
| sender_id        | bigint（必須）                            |
| body             | text（必須）                              |
| sent_at          | timestamp（必須）                         |
| deleted_at       | timestamp（nullable、ソフト削除）         |
| created_at       | timestamp                                 |
| updated_at       | timestamp                                 |
+------------------+------------------------------------------+

### 🔗 リレーション

- **Message → Thread（多対1の関係）**
  - メッセージは必ず1つのスレッドに紐づいています
  - どのスレッドに属するメッセージかを特定できます

### 🎯 主な使用場面

1. **メッセージ送信時**
   - チャット画面でメッセージを送信します
   - メッセージ本文、送信者情報、送信日時を保存します
   - スレッドの未読フラグを更新します

2. **チャット画面表示時**
   - スレッドに紐づくメッセージを時系列で表示します
   - 最初のメッセージ（応募文やスカウト文）を先頭に表示します
   - 削除されたメッセージは表示しません

3. **メッセージ削除時**
   - 自分のメッセージのみ削除可能です
   - ソフト削除で実装します（deleted_atカラムを使用）
   - 削除されたメッセージは画面に表示されませんが、データベースには残ります

### 💡 実装メモ

- **ソフト削除**：deleted_atカラムで論理削除を実装します（物理削除ではなく、削除フラグを立てるだけ）
- **送信者情報**：sender_typeとsender_idで送信者を特定します（企業かフリーランスかを区別）
- **時系列表示**：sent_atでソートして時系列で表示します（古い順に表示）

---

# 📌 モデル設計のポイントまとめ

## 共通設計原則

1. **リレーション設計**：適切なリレーションを設定し、データの取得を効率化します
2. **一意性制約**：重複を防ぐためにユニーク制約を設定します
3. **ソフト削除**：重要なデータはソフト削除で実装します（物理削除ではなく、削除フラグを立てるだけ）
4. **タイムスタンプ**：created_at、updated_atで作成・更新日時を管理します

## パフォーマンス考慮

1. **Eager Loading**：リレーションを事前に読み込んで、データベースへのアクセス回数を減らします
2. **インデックス**：検索対象のカラムにインデックスを設定して、検索速度を向上させます
3. **ページネーション**：一覧取得時は適切な件数でページネーションを実装します

## データ整合性

1. **外部キー制約**：リレーションの整合性を保証します
2. **カスケード削除**：親レコード削除時に子レコードも自動的に削除します
3. **バリデーション**：モデルレベルでバリデーションを実装します

## 使用場面の整理

- **登録・編集**：プロフィール・案件の登録・編集時に使用します
- **検索・一覧**：条件に合うデータを検索・一覧表示する際に使用します
- **コミュニケーション**：応募・スカウト・チャット機能で使用します
- **ステータス管理**：応募・スカウトの進捗を管理する際に使用します
