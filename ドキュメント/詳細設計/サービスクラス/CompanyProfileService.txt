# 🟩 CompanyProfileService：1つのメソッドの処理の流れ（初心者向け・段階的）

---

# ① **register（企業プロフィール登録処理）**

「企業ユーザーが企業プロフィール情報を登録する」ためのメソッド。

---

## ⭐ 全体のイメージ

1つの企業プロフィール登録が確定するまでに、

**バリデーション → 企業プロフィール作成 → 画面遷移**

という "一連の手続き" がまとめて行われる。

---

## 🔽 処理の流れ（ステップごとに優しく）

### **1. 登録できる状態かどうか確認する（バリデーション）**

- 企業名が必須で入力されているか
- 会社概要・担当者名・部署・自己紹介の文字数上限などが満たされているか
- user（role=company）が存在するか
- 既に企業プロフィールが登録済みでないか（再登録防止）

→ この時点で問題があれば登録は中断し、エラーを返す。

---

### **2. トランザクションを開始する（任意だが推奨）**

- companies テーブル更新が将来拡張（外部連携/担当者追加等）される可能性があるため
- 途中でエラーが発生した場合、変更を元に戻す必要がある

---

### **3. DB（companies テーブル）に企業プロフィールを作成する**

保存するカラム例：

- user_id
- company_name
- overview
- contact_name
- department
- introduction
- created_at / updated_at

---

### **4. トランザクションをコミットする**

- すべての処理が成功した場合、変更を確定する

---

### **5. 全体として「企業プロフィール登録が確定した状態」を返す**

- 作成された Company モデル
- 画面に表示する成功メッセージなど

---

---

# 🟦 💡 全体まとめ：registerメソッドの処理内容

+------------------+------------------------+----------------------------------+
| 処理内容         | DB更新                 | 主な目的                         |
+------------------+------------------------+----------------------------------+
| 企業プロフィール作成 | companies テーブル    | 企業としての基本情報を記録する   |
+------------------+------------------------+----------------------------------+

---

## 📌 エラーハンドリング

+------------------------+------------------------------------------+
| エラーケース           | 対応                                      |
+------------------------+------------------------------------------+
| バリデーションエラー   | 例外をスロー（Controller側でキャッチ）   |
| 既に企業プロフィール登録済み | バリデーションエラー（例外をスロー） |
| DBエラー               | ロールバック後、例外をスロー             |
+------------------------+------------------------------------------+

---

## 🔗 関連モデル

- Company
- User

---

## 💡 実装メモ

- Controller は「入口」に徹し、保存ロジックは Service に集約する
- 初回登録後の遷移先は `/company/freelancers`（詳細設計の導線）


