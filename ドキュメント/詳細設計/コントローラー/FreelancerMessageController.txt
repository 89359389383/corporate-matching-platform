**FreelancerMessageControllerï¼ˆãƒãƒ£ãƒƒãƒˆå‡¦ç†ï¼šé–²è¦§ãƒ»é€ä¿¡ï¼‰** ã‚’ MeetingController ã¨åŒã˜ç²’åº¦ã§ã¾ã¨ã‚ã¾ã™ã€‚

ã“ã®Controllerã¯ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹å´ã§ä»¥ä¸‹ã‚’æ‹…å½“ğŸ‘‡

+----------+------------------------------------------+
| å½¹å‰²     | å‹•ä½œ                                      |
+----------+------------------------------------------+
| threadè¡¨ç¤º | ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã®è¡¨ç¤º                      |
| messageé€ä¿¡ | æ–°è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æŠ•ç¨¿                      |
| æœªèª­è§£é™¤ | thread ã‚’é–‹ã„ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§æ—¢èª­æ‰±ã„ã«ã™ã‚‹ |
+----------+------------------------------------------+

â€»ä»•æ§˜æ ¹æ‹ ï¼š

âœ”å¿œå‹Ÿ/ã‚¹ã‚«ã‚¦ãƒˆç™ºç”Ÿæ™‚ã«threadè‡ªå‹•ä½œæˆ

å¿œå‹Ÿãƒ»ã‚¹ã‚«ã‚¦ãƒˆãƒ»ãƒãƒ£ãƒƒãƒˆã®ã€Œç™ºç”Ÿãƒˆãƒªã‚¬ãƒ¼ã€ã®é–¢ä¿‚æ€§

âœ” threadã¯ä¼æ¥­ Ã— ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹ Ã— æ¡ˆä»¶(or null)ã§1ã¤ã«çµ±ä¸€

ã‚¹ãƒ¬ãƒƒãƒ‰ï¼ˆãƒãƒ£ãƒƒãƒˆï¼‰ãŒä½•ã‚’è»¸ã«ç´ã¥ãã‹

âœ” æœªèª­ã¯ã€Œæœ€æ–°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡è€…ãŒè‡ªåˆ†ä»¥å¤–ãªã‚‰æœªèª­ã€

ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€šçŸ¥ã®æ‰±ã„

---

# âœ… FreelancerMessageControllerï¼ˆãƒãƒ£ãƒƒãƒˆï¼‰è©³ç´°è¨­è¨ˆ

---

---

# â‘  showï¼ˆãƒãƒ£ãƒƒãƒˆç”»é¢ã®è¡¨ç¤ºï¼‰

### ğŸŒ± å½¹å‰²

ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹ãŒ **å¿œå‹Ÿæ¸ˆã¿ or ã‚¹ã‚«ã‚¦ãƒˆã•ã‚ŒãŸ thread ã‚’é–‹ãã€
ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚’é–²è¦§ã—ã€æœªèª­ã‚’è§£é™¤ã™ã‚‹**

---

### ğŸ¯ å…¥å£

```
GET /freelancer/threads/{thread}
```

---

### ğŸ“¤ å‡ºå£ï¼ˆè¿”å´ã™ã‚‹å†…å®¹ï¼‰

```
freelancer/threads/show.blade.php
```

ç”»é¢ã«ã¯ï¼š

+------------------------+------------------------------------------+
| è¡¨ç¤ºå†…å®¹               | èª¬æ˜                                      |
+------------------------+------------------------------------------+
| ãƒãƒ£ãƒƒãƒˆç›¸æ‰‹ä¼æ¥­å     | thread.company.name                       |
| linked jobï¼ˆæ¡ˆä»¶åï¼‰   | thread.job.title or "æ¡ˆä»¶æœªæŒ‡å®š"         |
| messageä¸€è¦§           | æœ€æ–°é † or å¤ã„é †                         |
| æ–°è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›æ¬„   | textareaï¼‹é€ä¿¡button                     |
| å‰Šé™¤ãƒœã‚¿ãƒ³             | ã€Œè‡ªåˆ†ãŒæœ€å¾Œã«é€ã£ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ã ã‘å¯ï¼ˆä»•æ§˜ï¼‰ |
+------------------------+------------------------------------------+

---

### ğŸ§  Controllerå†…éƒ¨å‡¦ç†

+----------------------------+--------------------------+
| ã‚¹ãƒ†ãƒƒãƒ—                   | å†…å®¹                      |
+----------------------------+--------------------------+
| â‘  èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶å–å¾—       | role=freelancer           |
| â‘¡ threadå–å¾—               | Route Model Binding       |
| â‘¢ threadå¯¾è±¡ãƒ¦ãƒ¼ã‚¶æ¨©é™ãƒã‚§ãƒƒã‚¯ | ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹é˜²æ­¢     |
| â‘£ messageså–å¾—             | message with user         |
| â‘¤ æœ€æ–°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡è€…åˆ¤å®š | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€šçŸ¥ã®æ‰±ã„   |
| â‘¥ æœªèª­è§£é™¤å‡¦ç†             | **serviceã«å§”è­²** â†’ threadå˜ä½ |
+----------------------------+--------------------------+

â—é‡è¦

æœªèª­è§£é™¤ã¯ã€Œthreadèª­ã‚€ã ã‘ã ã¨ä¸è¦ï¼Ÿã€ã¨æ„Ÿã˜ãŒã¡ã§ã™ãŒ

- æœªèª­ãƒãƒƒã‚¸ã‚’OFFã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–° or ãƒ•ãƒ©ã‚°æ›´æ–°ãŒå¿…è¦

â¡ Controllerã«ã¯ç½®ã‹ãš

```
MessageService::markRead(thread_id, freelancer_id)

```

ã§ä¸€æ‹¬å‡¦ç†ã«ã™ã‚‹ã€‚

---

---

# â‘¡ storeï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡å‡¦ç†ï¼‰

### ğŸŒ± å½¹å‰²

- ãƒãƒ£ãƒƒãƒˆç”»é¢ã§é€ä¿¡ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ã
  â†’ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¿å­˜ ï¼‹ æœªèª­çŠ¶æ…‹æ›´æ–°ï¼ˆç›¸æ‰‹å´ã‚’æœªèª­ã«ã™ã‚‹ï¼‰

â€»è¤‡æ•°ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°ï¼ˆmessages, threadsï¼‰ãŒçµ¡ã‚€ãŸã‚ **Serviceå¿…é ˆ**

---

### ğŸ¯ å…¥å£

```
POST /threads/{thread}/messages
payload:
- contentï¼ˆæœ¬æ–‡ï¼‰
```

---

### ğŸ§  Controllerå†…éƒ¨å‡¦ç†

ã‚„ã‚‹ã“ã¨ã¯æœ€å°é™ğŸ‘‡

+------------------+------------------------------+
| Step             | å†…å®¹                         |
+------------------+------------------------------+
| â‘  èªè¨¼ãƒ¦ãƒ¼ã‚¶å–å¾— | Auth::user()                 |
| â‘¡ threadå–å¾—     | Route Binding                |
| â‘¢ æ¨©é™ãƒã‚§ãƒƒã‚¯   | threadã®å½“äº‹è€…ã‹             |
| â‘£ è»½ã„ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | content required          |
| â‘¤ Serviceã¸å‡¦ç†å§”è­² | MessageService::send(...) |
| â‘¥ redirectå…ƒç”»é¢ã¸ | thread.show ã¸             |
+------------------+------------------------------+

---

### ğŸ“¤ å‡ºå£

```
redirect /freelancer/threads/{thread}
Flash: ã€Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã—ãŸã€
```

---

---

# â‘¢ destroyï¼ˆç›´å‰ã®è‡ªåˆ†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‰Šé™¤ï¼‰

### ğŸŒ± å½¹å‰²

- ãƒãƒ£ãƒƒãƒˆå†…ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ **è‡ªåˆ†ãŒæœ€å¾Œã«é€ã£ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿** å‰Šé™¤ã§ãã‚‹å‡¦ç†
- DBæ›´æ–°ã¯ message å‰Šé™¤ã®ã¿ï¼ˆthreadsæœªèª­æ›´æ–°ã¯ä¸è¦æƒ³å®šï¼‰

---

### ğŸ¯ å…¥å£

```
DELETE /threads/{thread}/messages/{message}
```

---

### ğŸ§  Controllerå†…éƒ¨å‡¦ç†

+------------------+----------------------------------+
| Step             | å†…å®¹                             |
+------------------+----------------------------------+
| â‘  èªè¨¼ãƒ¦ãƒ¼ã‚¶å–å¾— | Auth::user()                     |
| â‘¡ threadå–å¾—     | RouteBinding                     |
| â‘¢ messageå–å¾—    | RouteBinding                     |
| â‘£ æ¨©é™ãƒã‚§ãƒƒã‚¯   | message.sender_id == user.id     |
| â‘¤ å‰Šé™¤å®Ÿè¡Œ       | message->delete()                |
| â‘¥ redirect back  | thread.showã¸                     |
+------------------+----------------------------------+

---

### ğŸ“¤ å‡ºå£

```
redirect /freelancer/threads/{thread}
Flash: ã€Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€
```

---

---

# ğŸ“Œ FreelancerMessageControllerã¾ã¨ã‚

+----------+------------------------+------------------------+------------------+---------------------------+
| ãƒ¡ã‚½ãƒƒãƒ‰ | å½¹å‰²                   | å…¥å£                   | å‡ºå£             | Service                  |
+----------+------------------------+------------------------+------------------+---------------------------+
| show     | threadè¡¨ç¤ºï¼‹æœªèª­è§£é™¤   | GET /freelancer/threads/{thread} | viewè¿”å´ | âœ” MessageService::markRead |
| store    | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ï¼‹æœªèª­æ›´æ–° | POST /threads/{thread}/messages | redirect | âœ” MessageService::send     |
| destroy  | æœ€æ–°ã®è‡ªåˆ†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‰Šé™¤ | DELETE /threads/{thread}/messages/{message} | redirect | âŒ ãªã— |
+----------+------------------------+------------------------+------------------+---------------------------+
