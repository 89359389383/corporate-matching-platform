- *「詳細設計に入る前に確認するための状態遷移メモ」**として、

**簡潔・読みやすさ最優先**で整理します。

これは

- 設計レビュー用
- 実装中に迷ったときの立ち戻り用

どちらにもそのまま使える粒度です。

---

# 状態遷移メモ（フェーズ①・確定版）

## 1. Job（案件）の状態遷移

### ステータス定義

+------+----------+------------------------------------------+
| 値   | 状態名   | 意味                                      |
+------+----------+------------------------------------------+
| 0    | 下書き   | 企業のみ閲覧可能                          |
| 1    | 公開     | フリーランス一覧に表示                    |
| 2    | 停止     | フリーランス非表示、企業管理のみ          |
+------+----------+------------------------------------------+

### 遷移ルール

- **作成直後**：`0（下書き）`
- **企業が公開操作**：`0 → 1`
- **企業が停止操作**：`1 → 2`
- **再公開する場合**：`2 → 1`（将来対応可）

### 表示条件

- フリーランス側
    - `status = 1` のみ表示
- 企業側
    - 全ステータス表示（管理目的）

---

## 2. Application / Scout（応募・スカウト）の状態遷移

※ 応募とスカウトは **同一ルール**

### ステータス定義

+------+----------+--------------------------+
| 値   | 状態名   | 意味                      |
+------+----------+--------------------------+
| 0    | 未対応   | 作成直後                  |
| 1    | 対応中   | チャット進行中            |
| 2    | クローズ | 対応完了（将来用）        |
+------+----------+--------------------------+

### 遷移ルール

- **作成直後**：`0（未対応）`
- **チャット開始後**：`0 → 1`
- **終了処理（将来）**：`1 → 2`

### 補足

- フェーズ①では
    - `2（クローズ）` への遷移操作は未実装
- 状態は **一覧表示・管理用の情報**
    - チャット可否は thread の存在で判断

---

## 3. Thread（チャット）の未読状態

### 未読フラグ

+------------------------+------------------+
| フラグ                 | 対象              |
+------------------------+------------------+
| is_unread_for_company  | 企業側未読        |
| is_unread_for_freelancer | フリーランス側未読 |
+------------------------+------------------+

### 更新ルール

### メッセージ送信時

- **送信者が企業**
    - `is_unread_for_freelancer = true`
    - `is_unread_for_company = false`
- **送信者がフリーランス**
    - `is_unread_for_company = true`
    - `is_unread_for_freelancer = false`

### スレッド表示時

- **企業がスレッドを開く**
    - `is_unread_for_company = false`
- **フリーランスがスレッドを開く**
    - `is_unread_for_freelancer = false`

### 補足

- 未読管理は **スレッド単位のみ**
- 既読テーブルは作成しない
- WebSocket 不使用（ページ遷移で更新）

---

## 4. 状態管理の設計方針（確認用）

- 状態数は **最小限**
- 状態遷移は **ユーザー操作起点のみ**
- 外部同期・非同期処理なし
- フェーズ①では
    - 「複雑な分岐を作らない」ことを優先

---

## ✔ このメモの使いどころ

- 詳細設計・実装中に
    
    「この状態、いつ変わるんだっけ？」
    
    となったときの即確認用
    
- 将来フェーズ②で機能追加するときの
    
    **拡張ポイントの基準**